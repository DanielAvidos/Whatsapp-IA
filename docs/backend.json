{
  "entities": {
    "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents a company (client) within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Company entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the company."
        },
        "status": {
          "type": "string",
          "description": "The status of the company (Active, Suspended).",
          "enum": ["Active", "Suspended"]
        },
        "plan": {
          "type": "string",
          "description": "The plan associated with the company (Free, Pro, Enterprise).",
          "enum": ["Free", "Pro", "Enterprise"]
        },
        "adminEmail": {
          "type": "string",
          "format": "email",
          "description": "The email of the company administrator."
        },
        "adminUid": {
          "type": "string",
          "description": "The Firebase Auth UID of the company administrator."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "name",
        "status",
        "plan",
        "adminEmail",
        "adminUid"
      ]
    },
    "Member": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Member",
      "type": "object",
      "description": "Represents a member within a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Member entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Member)"
        },
        "userId": {
          "type": "string",
          "description": "Unique identifier for the user from the authentication system."
        },
        "role": {
          "type": "string",
          "description": "The role of the member within the tenant (e.g., owner, admin, agent, viewer)."
        },
        "status": {
          "type": "string",
          "description": "The status of the member (e.g., active, invited, disabled)."
        }
      },
      "required": [
        "id",
        "tenantId",
        "userId",
        "role",
        "status"
      ]
    },
    "Channel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Channel",
      "type": "object",
      "description": "Represents a communication channel (e.g., WhatsApp number) within a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Channel entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N Channel)"
        },
        "name": {
          "type": "string",
          "description": "Name of the channel."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The phone number associated with the channel."
        },
        "status": {
          "type": "string",
          "description": "The status of the channel (e.g., CONNECTED, DISCONNECTED, CONNECTING)."
        }
      },
      "required": [
        "id",
        "tenantId",
        "name",
        "phoneNumber",
        "status"
      ]
    },
    "ApiKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiKey",
      "type": "object",
      "description": "Represents a placeholder API key for a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ApiKey entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N ApiKey)"
        },
        "keyPrefix": {
          "type": "string",
          "description": "The prefix of the API key."
        },
        "scopes": {
          "type": "array",
          "description": "An array of scopes associated with the API key (e.g., messages:send, channels:read).",
          "items": {
            "type": "string"
          }
        },
        "hashedKey": {
          "type": "string",
          "description": "A placeholder hash of the full API key."
        }
      },
      "required": [
        "id",
        "tenantId",
        "keyPrefix",
        "scopes",
        "hashedKey"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application obtained from Firebase Authentication.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, matching the Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL to the user's profile photo, optional",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "WhatsappConnection": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WhatsappConnection",
      "type": "object",
      "description": "Represents the state of the default WhatsApp connection for testing.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The document ID, should be 'default'."
        },
        "displayName": {
          "type": "string",
          "description": "The display name for the channel."
        },
        "status": {
          "type": "string",
          "description": "The connection status.",
          "enum": [
            "DISCONNECTED",
            "CONNECTING",
            "CONNECTED"
          ]
        },
        "qr": {
          "type": [
            "string",
            "null"
          ],
          "description": "The QR code string for linking the device."
        },
        "phoneE164": {
          "type": [
            "string",
            "null"
          ],
          "description": "The E.164 formatted phone number associated with the connection."
        },
        "lastSeenAt": {
          "type": [
            "string",
            "null"
          ],
          "format": "date-time",
          "description": "Timestamp of the last activity from the connected device."
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last update to this document."
        }
      },
      "required": [
        "id",
        "displayName",
        "status",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": {
            "$ref": "#/backend/entities/Company"
          },
          "description": "Collection to store company clients.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier of the company."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store admin roles. Existence of a document grants admin privileges. User ID matches Firebase Auth UID. The super admin UID is d6Agbzw3qpgHtykUBnBDs86vg1S2.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user data. User ID matches Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}",
        "definition": {
          "entityName": "Tenant",
          "schema": {
            "$ref": "#/backend/entities/Tenant"
          },
          "description": "Collection to store tenant data.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier of the tenant."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/members/{memberId}",
        "definition": {
          "entityName": "Member",
          "schema": {
            "$ref": "#/backend/entities/Member"
          },
          "description": "Subcollection to store tenant members. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier of the tenant."
            },
            {
              "name": "memberId",
              "description": "The unique identifier of the member."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/channels/{channelId}",
        "definition": {
          "entityName": "Channel",
          "schema": {
            "$ref": "#/backend/entities/Channel"
          },
          "description": "Subcollection to store tenant channels. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier of the tenant."
            },
            {
              "name": "channelId",
              "description": "The unique identifier of the channel."
            }
          ]
        }
      },
      {
        "path": "/tenants/{tenantId}/apiKeys/{apiKeyId}",
        "definition": {
          "entityName": "ApiKey",
          "schema": {
            "$ref": "#/backend/entities/ApiKey"
          },
          "description": "Subcollection to store tenant API keys. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier of the tenant."
            },
            {
              "name": "apiKeyId",
              "description": "The unique identifier of the API key."
            }
          ]
        }
      },
      {
        "path": "/channels/{channelId}",
        "definition": {
          "entityName": "WhatsappConnection",
          "schema": {
            "$ref": "#/backend/entities/WhatsappConnection"
          },
          "description": "Collection to store WhatsApp connection state. The main document is 'default'.",
          "params": [
            {
              "name": "channelId",
              "description": "The identifier for the channel, usually 'default'."
            }
          ]
        }
      }
    ]
  }
}
